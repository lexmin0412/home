# React Hooks

## Hook ç®€ä»‹

### Hook æ˜¯ä»€ä¹ˆï¼Ÿ

ä¸€å¥è¯è¡¨è¿°ï¼šHook æ˜¯ React16.8 çš„æ–°å¢ç‰¹æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state å’Œ React çš„å…¶ä»–ç‰¹æ€§ã€‚

ä½œä¸ºç¤ºä¾‹ï¼šçœ‹çœ‹ useState hook æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼š

```tsx
import React, { useState } from 'react';

function Example() {
  // å£°æ˜ä¸€ä¸ªæ–°çš„å«åš â€œcountâ€ çš„ state å˜é‡
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
```

useState è¿™ä¸ª hook çš„æ¥æ”¶ä¸€ä¸ªçŠ¶æ€çš„åˆå§‹å€¼ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯çŠ¶æ€æœ¬èº«ï¼Œå¦ä¸€ä¸ªæ˜¯å˜æ›´çŠ¶æ€çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶å˜æ›´åçš„å€¼ä½œä¸ºå‚æ•°ã€‚

### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ hook?

å¦‚æœåœ¨ç¼–å†™æˆ–æ‰©å±•ä¸€ä¸ªå‡½æ•°ç»„ä»¶æ—¶éœ€è¦å‘å…¶æ·»åŠ ä¸€äº› state, ä»¥å‰çš„åšæ³•æ˜¯å¿…é¡»å°†å…¶è½¬æ¢ä¸º class ç»„ä»¶ï¼Œè€Œç°åœ¨æœ‰äº†hookï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ class çš„èƒ½åŠ›ã€‚

### åŠ¨æœº

hook çš„å‡ºç°ï¼Œæ˜¯ç”¨æ¥è§£å†³ä»¥ä¸‹é—®é¢˜çš„ï¼š

#### 1. åœ¨ç»„ä»¶ä¹‹é—´éš¾ä»¥å¤ç”¨çŠ¶æ€é€»è¾‘

å¦‚æœä¸€äº›éœ€è¦å¤ç”¨çš„é€»è¾‘é‡Œé¢åŒ…å«äº†çŠ¶æ€( state/prop )ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ HOC æˆ– render props æ¥å®ç°ï¼Œä½†å®ƒä»¬çš„å…±åŒç‰¹ç‚¹æ˜¯ï¼šéœ€è¦é‡æ–°ç»„ç»‡ç»„ä»¶ç»“æ„ã€‚è€Œ hook ä¸éœ€è¦ã€‚

#### 2. ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­å­˜åœ¨ç€å¤ªå¤šä¸ç›¸å…³çš„å‰¯ä½œç”¨

æˆ‘ä»¬çš„ç»„ä»¶ä¸€å¼€å§‹å¯èƒ½åªæœ‰å¾ˆç®€å•çš„é€»è¾‘ï¼Œä½†æ˜¯éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œé€æ¸ä¼šè¢«çŠ¶æ€é€»è¾‘å’Œå‰¯ä½œç”¨å……æ–¥ï¼Œ æ¯ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å¯èƒ½éƒ½å­˜åœ¨ç€å„ä¸ç›¸å…³çš„é€»è¾‘ã€‚æ¯”å¦‚ç»„ä»¶ç»å¸¸ä¼šåœ¨ componentDidMount å’Œ componentDidUpdate ä¸­è·å–æ•°æ®ï¼ˆæ¯”å¦‚æœç´¢æ¡†ç»„ä»¶ï¼Œæ¯æ¬¡è¾“å…¥åéƒ½éœ€è¦é‡æ–°æŸ¥è¯¢æ•°æ®ï¼‰ï¼Œä½† componentDidMount ä¸­åˆå¯èƒ½åŒ…å«å…¶ä»–çš„é€»è¾‘ï¼Œæ¯”å¦‚è®¾ç½®äº‹ä»¶ç›‘å¬ï¼Œç„¶åè¿™ä¸ªäº‹ä»¶ç›‘å¬åˆéœ€è¦å† componentWillUnmuontä¸­æ¸…é™¤ã€‚

è¿™ç§æ–¹å¼å°±ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ï¼šè¯·æ±‚æ•°æ®çš„é€»è¾‘éœ€è¦åœ¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸä¸­ä¹¦å†™ï¼Œå¦‚æœæœ‰æ”¹åŠ¨ä¹Ÿéœ€è¦åŒæ—¶æ”¹åŠ¨å¤šå¤„ä»£ç ï¼›è€Œä¸ç›¸å…³çš„äº‹ä»¶ç›‘å¬å´å’Œè¯·æ±‚æ•°æ®è¢«ä¸€åŒæ”¾åœ¨äº† componentDidMount ä¸­ï¼Œè¿™æ ·å¾ˆå®¹æ˜“é€ æˆä¸€äº›bugã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHook å°†ç»„ä»¶ä¸­ç›¸å…³çš„é€»è¾‘æ‹†åˆ†æˆäº†æ›´å°ç²’åº¦çš„å‡½æ•°ï¼ˆå¦‚å°†è¯·æ±‚æ•°æ®å’Œäº‹ä»¶ç›‘å¬åˆ†ç¦»ï¼‰ï¼Œè€Œéåœ¨ç”Ÿå‘½å‘¨æœŸä¸­ä¹¦å†™ã€‚

#### 3. éš¾ä»¥ç†è§£çš„ class

åœ¨ä½¿ç”¨ class æ—¶ï¼Œå¿…é¡»è¦å»ç†è§£ javascript ä¸­ this çš„å·¥ä½œæ–¹å¼ï¼Œè€Œä¸”è¿˜éœ€è¦ç»‘å®šäº‹ä»¶å¤„ç†å™¨ã€‚

åœ¨ hook å‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ç»„ä»¶çš„ç±»å‹å»å†³å®šåˆ°åº•ä½¿ç”¨ class ç»„ä»¶è¿˜æ˜¯å‡½æ•°ç»„ä»¶ï¼ˆæœ‰çŠ¶æ€ä½¿ç”¨ classï¼Œæ— çŠ¶æ€ä½¿ç”¨å‡½æ•°ç»„ä»¶ï¼‰ï¼Œè€Œç°åœ¨ï¼Œåœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ hookï¼Œå¯ä»¥åšåˆ°å¤§éƒ¨åˆ† class å¯ä»¥åšåˆ°çš„äº‹æƒ…ï¼Œè€Œä¸”åœ¨å¤§å¤šæ•°æ—¶å€™çš„ä½¿ç”¨æ›´ä¸ºæ–¹ä¾¿ã€‚

### class ä¼šè¢«æ”¾å¼ƒå—ï¼Ÿ

> æ²¡æœ‰è®¡åˆ’ä» React ä¸­ç§»é™¤ classã€‚

ä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ classï¼Œå¯ä»¥ä½¿ç”¨ hookï¼Œä¹Ÿå¯ä»¥ä¸¤è€…æ··ç”¨ã€‚

React å®˜æ–¹è®¡åˆ’ä¸º hook è¦†ç›–æ‰€æœ‰ class ç»„ä»¶çš„ä½¿ç”¨åœºæ™¯ï¼Œä½†ä¹Ÿä¼šç»§ç»­ä¸º class æä¾›æ”¯æŒã€‚

>æ³¨æ„ï¼š
>
>`getSnapshotBeforeUpdate`ï¼Œ`componentDidCatch` ä»¥åŠ `getDerivedStateFromError`ï¼šç›®å‰è¿˜æ²¡æœ‰è¿™äº›æ–¹æ³•çš„ Hook ç­‰ä»·å†™æ³•ï¼Œä½†å¾ˆå¿«ä¼šè¢«æ·»åŠ ã€‚

## React é¢„ç½®çš„ Hook

### useState

`useState` æ¥å—ä¸€ä¸ªå‚æ•°ï¼šåˆå§‹ stateï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå½“å‰ stateï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºæ›´æ–° state çš„å‡½æ•°ã€‚å®ƒä»¬ç±»ä¼¼äº class ç»„ä»¶ä¸­çš„ state å’Œ setStateï¼ŒåŒºåˆ«åœ¨äºä½¿ç”¨ useState hookï¼Œèµ‹çš„å€¼å¯ä»¥ä¸æ˜¯å¯¹è±¡ï¼Œä¸”éœ€è¦æˆå¯¹è·å– state æœ¬èº«ä¸æ›´æ–°å‡½æ•°ã€‚

#### åŸºç¡€ç”¨æ³•

```tsx
import React, { useState } from 'react';

function Example() {
  // å£°æ˜ä¸€ä¸ªå« "count" çš„ state å˜é‡
  const [count, setCount] = useState(0);
  return (
    <button onClick={()=>setCount(count+1)}>ç‚¹å‡»æ¬¡æ•°ï¼š{count}</button>
  )
}
```

åœ¨ Example ç»„ä»¶ä¸­ï¼Œåˆå§‹åŒ–äº†ä¸€ä¸ªåä¸º count çš„ stateï¼Œå¹¶ç»™å®ƒèµ‹å€¼ä¸º0ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œä¼šä¼ é€’åŠ 1åçš„å€¼ç»™ setCount æ–¹æ³•å¹¶è°ƒç”¨ï¼ŒReact ä¼šé‡æ–°æ¸²æŸ“ Example ç»„ä»¶å¹¶ä¼ é€’æœ€æ–°çš„ count å€¼ç»™å®ƒã€‚

#### ä½¿ç”¨å¤šä¸ª state

```tsx
function ExampleWithManyStates() {
  // å£°æ˜å¤šä¸ª state å˜é‡
  const [age, setAge] = useState(42);
  const [fruit, setFruit] = useState('banana');
  const [todos, setTodos] = useState([{ text: 'å­¦ä¹  Hook' }]);
}
```

#### æ³¨æ„

å½“ state ä¸ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè·Ÿ class ä¸­çš„ setState ä¸åŒçš„æ˜¯ï¼Œä½¿ç”¨ hook æ›´æ–° state å˜é‡æ€»æ˜¯ä¼š **æ›¿æ¢** å®ƒè€Œä¸æ˜¯åˆå¹¶å®ƒã€‚

### useEffect

effct hook å¯ä»¥è®©ä½ åœ¨å‡½æ•°ç»„ä»¶ä¸­æ‰§è¡Œå‰¯ä½œç”¨æ“ä½œï¼Œå¦‚è¯·æ±‚æ•°æ®ã€æ·»åŠ äº‹ä»¶ç›‘å¬ã€è®¾ç½®å®šæ—¶å™¨ã€æ“ä½œDOMç­‰ã€‚å®ƒå¯ä»¥å‘Šè¯‰ React ç»„ä»¶éœ€è¦åœ¨æ¸²æŸ“åæ‰§è¡Œä¸Šè¿°æ“ä½œã€‚React ä¼šä¿å­˜ä½ çš„å‡½æ•°ï¼Œå¹¶åœ¨æ‰§è¡Œ DOM æ›´æ–°ä¹‹åè°ƒç”¨å®ƒã€‚

> å¯ä»¥æŠŠ useEffct çœ‹æˆæ˜¯ componentDidMountã€componentDidUpdateã€componentWillUnMount çš„ç»„åˆã€‚

è®©æˆ‘ä»¬æ¥ç”¨ useEffect æ¥å®ç°ä¸€ä¸ªæ“ä½œ DOM çš„å‰¯ä½œç”¨ï¼š

```tsx
import React, { useState, useEffect } from 'react';

function Example() {
  const [count, setCount] = useState(0);

  useEffect(() =>
    document.title = `You clicked ${count} times`;
  });

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
```

åœ¨ä¸Šé¢çš„ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ useEffct æ¥å®ç°ç”¨æˆ·ç‚¹å‡»æ—¶è®°å½•ç‚¹å‡»æ¬¡æ•°å¹¶æ›´æ–°é¡µé¢æ ‡é¢˜ï¼Œå®ƒç›¸å½“äºåœ¨ class ç»„ä»¶ä¸­çš„ componentDidMount å’Œ componentDidUpdate ç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œç›¸åŒçš„é€»è¾‘ã€‚

#### effct åˆ†ç±»

##### æ— éœ€æ¸…é™¤çš„ effct

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åªæƒ³åœ¨ React æ›´æ–° DOM ä¹‹åè¿è¡Œä¸€äº›é¢å¤–çš„ä»£ç ï¼Œæ¯”å¦‚å‘é€ç½‘ç»œè¯·æ±‚ï¼Œæ‰‹åŠ¨å˜æ›´ DOMï¼Œè®°å½•æ—¥å¿—ç­‰ï¼Œè¿™äº›éƒ½æ˜¯å¸¸è§çš„æ— éœ€æ¸…é™¤çš„æ“ä½œï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ‰§è¡Œå®Œè¿™äº›æ“ä½œä¹‹åå°±å¯ä»¥å¿½ç•¥ä»–ä»¬äº†ã€‚

##### éœ€è¦æ¸…é™¤çš„ effect

æœ‰ä¸€äº›å‰¯ä½œç”¨æ˜¯éœ€è¦æ¸…é™¤çš„ï¼Œæ¯”å¦‚è®¢é˜…å¤–éƒ¨æ•°æ®æºã€è®¾ç½®å®šæ—¶å™¨ç­‰ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ¸…é™¤å·¥ä½œæ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šå¼•èµ·å†…å­˜æ³„æ¼ã€‚

åœ¨ class ä¸­ï¼Œé€šå¸¸åœ¨ componentDidMount ä¸­è®¾ç½®è®¢é˜…ï¼Œç„¶ååœ¨ componentWillUnMount ä¸­æ¸…é™¤è®¢é˜…ã€‚è€Œä½¿ç”¨ useEffectï¼Œæˆ‘ä»¬å¯ä»¥ ä¸€æ¬¡å°±æ‰§è¡Œå®Œç›¸å…³çš„é€»è¾‘ï¼š

```tsx
import React, { useState, useEffect } from 'react';

function FriendStatus(props) {
  const [isOnline, setIsOnline] = useState(null);

  useEffect(() => {
    function handleStatusChange(status) {
      setIsOnline(status.isOnline);
    }
    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
    return () => {
      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
    };
  });

  if (isOnline === null) {
    return 'Loading...';
  }
  return isOnline ? 'Online' : 'Offline';
}
```

æ¯ä¸€ä¸ª effct ä¸­éƒ½å¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æŒ‡å®šå¦‚ä½•æ¸…é™¤å‰¯ä½œç”¨ã€‚å¦‚æœä½ çš„ effct ä¸­è¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼ŒReact å°†åœ¨ç»„ä»¶å¸è½½æ—¶è°ƒç”¨å®ƒã€‚

#### æ‰§è¡Œæ—¶æœº

é»˜è®¤æƒ…å†µä¸‹ï¼ŒuseEffect åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“å’Œæ¯ä¸€æ¬¡é‡æ–°æ¸²æŸ“ä¹‹åéƒ½ä¼šæ‰§è¡Œã€‚ä½ ä¸ç”¨å»å…³å¿ƒç»„ä»¶åˆ°åº•æ˜¯å‡ºäºâ€œæŒ‚è½½â€è¿˜æ˜¯â€œæ›´æ–°â€çŠ¶æ€ã€‚React ä¿è¯äº†æ¯æ¬¡è¿è¡Œ useEffect æ—¶ï¼ŒDOM éƒ½å·²ç»æ›´æ–°å®Œæ¯•ã€‚

æˆ‘ä»¬ä¼šæ³¨æ„åˆ°ï¼Œä¼ é€’ç»™ useEffect çš„å‡½æ•°åœ¨æ¯æ¬¡æ¸²æŸ“ä¸­éƒ½æ˜¯ä¸åŒçš„ï¼Œè¿™æ˜¯åˆ»æ„ä¸ºä¹‹çš„è®¾è®¡ã€‚æ­£æ˜¯å› ä¸ºå¦‚æ­¤ï¼Œå®ƒæ‰ä¿è¯äº†æˆ‘ä»¬å¯ä»¥åœ¨ effect ä¸­è·å–æœ€æ–°çš„ count å€¼ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå…¶è¿‡æœŸã€‚æ¯æ¬¡é‡æ–°æ¸²æŸ“ï¼Œéƒ½ä¼šç”Ÿæˆæ–°çš„ effectï¼Œæ›¿æ¢æ‰ä¹‹å‰çš„ã€‚ä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œeffect æ›´åƒæ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ† â€”â€” æ¯ä¸€ä¸ª effect éƒ½å±äºä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚

> æç¤ºï¼šä¸ componentDidMount å’Œ componentDidUpdate ä¸åŒï¼Œä½¿ç”¨ useEffect è°ƒåº¦çš„ effect ä¸ä¼šé˜»æ­¢æµè§ˆå™¨æ›´æ–°å±å¹•ï¼Œè¿™è®©åº”ç”¨çœ‹èµ·æ¥å“åº”å¾—æ›´å¿«ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œeffct ä¸éœ€è¦åŒæ­¥æ‰§è¡Œã€‚åœ¨ä¸ªåˆ«æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚æµ‹é‡å¸ƒå±€ï¼‰ï¼Œæœ‰å•ç‹¬çš„ useLayoutEffect Hook å¯ä»¥ä½¿ç”¨ï¼Œå®ƒçš„ API å’Œ useEffect ç›¸åŒã€‚

#### ä½¿ç”¨å¤šä¸ª useEffect

```tsx
function FriendStatusWithCounter(props) {
  const [count, setCount] = useState(0);
  useEffect(() => {
    document.title = `You clicked ${count} times`;
  });

  const [isOnline, setIsOnline] = useState(null);
  useEffect(() => {
    function handleStatusChange(status) {
      setIsOnline(status.isOnline);
    }

    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);
    return () => {
      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
    };
  });
}
```

#### é€šè¿‡è·³è¿‡ Effect è¿›è¡Œæ€§èƒ½ä¼˜åŒ–

æ¯æ¬¡æ¸²æŸ“ä¹‹åéƒ½æ‰§è¡Œæ¸…ç†æˆ–è°ƒç”¨ effect å¯èƒ½ä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜ã€‚åœ¨ class ç»„ä»¶ä¸­ï¼Œä¸€èˆ¬é€šè¿‡åœ¨ componentDidUpdate ä¸­æ¯”è¾ƒå‰åçš„ props æˆ– state æ¥è§£å†³ï¼š

```tsx
componentDidUpdate(prevProps, prevState) {
  if (prevState.count !== this.state.count) {
    document.title = `You clicked ${this.state.count} times`;
  }
}
```

åœ¨ effect hook ä¸­ï¼Œå¦‚æœæŸäº›ç‰¹å®šå€¼åœ¨ä¸¤æ¬¡é‡æ¸²æŸ“ä¹‹é—´æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥é€šçŸ¥ React è·³è¿‡å¯¹ effct çš„è°ƒç”¨ï¼Œæ–¹å¼æ˜¯ä¼ é€’æ•°ç»„ç»™ useEffect çš„ç¬¬äºŒä¸ªå‚æ•°ï¼š

```tsx
useEffect(() => {
  document.title = `You clicked ${count} times`;
}, [count]); // ä»…åœ¨ count æ›´æ”¹æ—¶æ›´æ–°
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•° `[count]` çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼ŸReact åœ¨ effect è°ƒç”¨ä¹‹å‰å¯¹ useEffect ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°æ•°ç»„è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½è·Ÿä¹‹å‰çš„å€¼å®Œå…¨ç›¸ç­‰ï¼ŒReact å°±ä¼šè·³è¿‡è¿™ä¸ª effectï¼Œä»è€Œå®ç°æ€§èƒ½ä¼˜åŒ–ï¼›è€Œå¦‚æœæ•°ç»„ä¸­æœ‰å¤šä¸ªå…ƒç´ ï¼Œå…¶ä¸­ä»»æ„ä¸€ä¸ªåœ¨é‡æ¸²æŸ“ä¹‹åå‘ç”Ÿäº†å˜åŒ–ï¼ŒReact éƒ½ä¼šæ‰§è¡Œè¿™ä¸ª effectã€‚

åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œå¦‚æœ count çš„å€¼æ˜¯5ï¼Œè€Œé‡æ¸²æŸ“ä¹‹åçš„å€¼è¿˜æ˜¯5ï¼ŒReact å°±ä¼šè·³è¿‡è¿™ä¸ª effectã€‚

> æ³¨æ„ï¼š
>
> å¦‚æœä½ è¦ä½¿ç”¨æ­¤ä¼˜åŒ–æ–¹å¼ï¼Œè¯·ç¡®ä¿æ•°ç»„ä¸­åŒ…å«äº†**æ‰€æœ‰å¤–éƒ¨ä½œç”¨åŸŸä¸­ä¼šéšæ—¶é—´å˜åŒ–å¹¶ä¸”åœ¨ effect ä¸­ä½¿ç”¨çš„å˜é‡**ï¼Œå¦åˆ™ä½ çš„ä»£ç ä¼šå¼•ç”¨åˆ°å…ˆå‰æ¸²æŸ“ä¸­çš„æ—§å˜é‡ã€‚
>
> å¦‚æœæƒ³æ‰§è¡Œåªè¿è¡Œä¸€æ¬¡çš„ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ`[]`ï¼‰ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™å°±å‘Šè¯‰ React ä½ çš„ effect ä¸ä¾èµ–äº props æˆ– state ä¸­çš„ä»»ä½•å€¼ï¼Œæ‰€ä»¥å®ƒæ°¸è¿œéƒ½ä¸éœ€è¦é‡å¤æ‰§è¡Œã€‚è¿™å¹¶ä¸å±äºç‰¹æ®Šæƒ…å†µ â€”â€” å®ƒä¾ç„¶éµå¾ªä¾èµ–æ•°ç»„çš„å·¥ä½œæ–¹å¼ã€‚
>
> å¦‚æœä½ ä¼ å…¥äº†ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ`[]`ï¼‰ï¼Œeffect å†…éƒ¨çš„ props å’Œ state å°±ä¼šä¸€ç›´æ‹¥æœ‰å…¶åˆå§‹å€¼ã€‚

## Hook çš„ä½¿ç”¨è§„åˆ™

hook å°±æ˜¯ js å‡½æ•°ï¼Œä½†æ˜¯ä½¿ç”¨å®ƒä¼šæœ‰ä¸¤ä¸ªé¢å¤–çš„è§„åˆ™ï¼š

#### åªèƒ½åœ¨å‡½æ•°æœ€å¤–å±‚è°ƒç”¨ hook

ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­æˆ–è€…å­å‡½æ•°ä¸­è°ƒç”¨ï¼›

#### åªèƒ½åœ¨ React çš„å‡½æ•°ä¸­è°ƒç”¨ hook

ä¸è¦åœ¨æ™®é€šçš„ JavaScript å‡½æ•°ä¸­è°ƒç”¨ hookã€‚å¯ä»¥åœ¨ä»¥ä¸‹æƒ…å†µè°ƒç”¨ hookï¼š

- åœ¨ React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨
- åœ¨è‡ªå®šä¹‰ hook ä¸­è°ƒç”¨å…¶ä»– hook

#### Hook ä¹¦å†™è§„åˆ™

æˆ‘ä»¬å¯ä»¥åœ¨å•ä¸ªç»„ä»¶ä¸­ä½¿ç”¨å¤šä¸ª State Hook æˆ– Effect Hook

```tsx
function Form() {
  // 1. Use the name state variable
  const [name, setName] = useState('Mary');

  // 2. Use an effect for persisting the form
  useEffect(function persistForm() {
    localStorage.setItem('formData', name);
  });

  // 3. Use the surname state variable
  const [surname, setSurname] = useState('Poppins');

  // 4. Use an effect for updating the title
  useEffect(function updateTitle() {
    document.title = name + ' ' + surname;
  });

  // ...
}
```

React æ€ä¹ˆçŸ¥é“å“ªä¸ª state å¯¹åº”å“ªä¸ª useStateï¼Ÿç­”æ¡ˆæ˜¯é  Hook è°ƒç”¨çš„é¡ºåºã€‚

```tsx
// é¦–æ¬¡æ¸²æŸ“
// ------------
useState('Mary')           // 1. ä½¿ç”¨ 'Mary' åˆå§‹åŒ–å˜é‡åä¸º name çš„ state
useEffect(persistForm)     // 2. æ·»åŠ  effect ä»¥ä¿å­˜ form æ“ä½œ
useState('Poppins')        // 3. ä½¿ç”¨ 'Poppins' åˆå§‹åŒ–å˜é‡åä¸º surname çš„ state
useEffect(updateTitle)     // 4. æ·»åŠ  effect ä»¥æ›´æ–°æ ‡é¢˜

// -------------
// äºŒæ¬¡æ¸²æŸ“
// -------------
useState('Mary')           // 1. è¯»å–å˜é‡åä¸º name çš„ stateï¼ˆå‚æ•°è¢«å¿½ç•¥ï¼‰
useEffect(persistForm)     // 2. æ›¿æ¢ä¿å­˜ form çš„ effect
useState('Poppins')        // 3. è¯»å–å˜é‡åä¸º surname çš„ stateï¼ˆå‚æ•°è¢«å¿½ç•¥ï¼‰
useEffect(updateTitle)     // 4. æ›¿æ¢æ›´æ–°æ ‡é¢˜çš„ effect
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œhook çš„è°ƒç”¨é¡ºåºåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚

ä½†å¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ª hook æ”¾åˆ°ä¸€ä¸ªæ¡ä»¶è¯­å¥ä¸­å‘¢ï¼Ÿ

```tsx
if (name !== '') {
  useEffect(function persistForm() {
    localStorage.setItem('formData', name);
  });
}
```

åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œname çš„å€¼ä¸ä¸ºç©ºï¼Œæ‰€ä»¥ hook å¯ä»¥æ­£å¸¸è¢«æ‰§è¡Œã€‚ä½†åœ¨æŸä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œå¦‚æœè¡¨å•å€¼è¢«æ¸…ç©ºäº†ï¼Œè¿™ä¸ª hook å°±ä¸ä¼šè¢«æ‰§è¡Œäº†ã€‚hook è°ƒç”¨é¡ºåºå˜æˆäº†å¦‚ä¸‹ï¼š

```tsx
useState('Mary')           // 1. è¯»å–å˜é‡åä¸º name çš„ stateï¼ˆå‚æ•°è¢«å¿½ç•¥ï¼‰
// useEffect(persistForm)  // ğŸ”´ æ­¤ Hook è¢«å¿½ç•¥ï¼
useState('Poppins')        // ğŸ”´ 2 ï¼ˆä¹‹å‰ä¸º 3ï¼‰ã€‚è¯»å–å˜é‡åä¸º surname çš„ state å¤±è´¥
useEffect(updateTitle)     // ğŸ”´ 3 ï¼ˆä¹‹å‰ä¸º 4ï¼‰ã€‚æ›¿æ¢æ›´æ–°æ ‡é¢˜çš„ effect å¤±è´¥
```

React ä¸çŸ¥é“ç¬¬äºŒä¸ª `useState` çš„ Hook åº”è¯¥è¿”å›ä»€ä¹ˆã€‚React ä¼šä»¥ä¸ºåœ¨è¯¥ç»„ä»¶ä¸­ç¬¬äºŒä¸ª Hook çš„è°ƒç”¨åƒä¸Šæ¬¡çš„æ¸²æŸ“ä¸€æ ·ï¼Œå¯¹åº”çš„æ˜¯ `persistForm` çš„ effectï¼Œä½†å¹¶éå¦‚æ­¤ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œåé¢çš„ Hook è°ƒç”¨éƒ½è¢«æå‰æ‰§è¡Œï¼Œå¯¼è‡´ bug çš„äº§ç”Ÿã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ **hook è¦åœ¨å‡½æ•°çš„æœ€é¡¶å±‚è°ƒç”¨** ã€‚

å¦‚æœæˆ‘ä»¬æƒ³è¦æœ‰æ¡ä»¶åœ°æ‰§è¡Œä¸€ä¸ª effectï¼Œå¯ä»¥å°†åˆ¤æ–­æ”¾åˆ° Hook çš„*å†…éƒ¨*ï¼š

```tsx
useEffect(function persistForm() {
  // ğŸ‘ å°†æ¡ä»¶åˆ¤æ–­æ”¾ç½®åœ¨ effect ä¸­
  if (name !== '') {
    localStorage.setItem('formData', name);
  }
});
```

## è‡ªå®šä¹‰ Hook

è‡ªå®šä¹‰ hook å¯ä»¥å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ã€‚å®ƒæ˜¯ä¸€ç§è‡ªç„¶éµå¾ª hook è®¾è®¡çš„çº¦å®šï¼Œè€Œä¸æ˜¯ React çš„ç‰¹æ€§ã€‚

æ³¨æ„ï¼š

**è‡ªå®šä¹‰ hook å¿…é¡»ä»¥ use å¼€å¤´** ï¼Œå¦åˆ™ React å°†æ— æ³•è‡ªåŠ¨æ£€æŸ¥ä½ çš„ hook æ˜¯å¦è¿åäº† hook çš„å®šä¹‰è§„åˆ™ã€‚

**åœ¨ä¸¤ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ hook ä¼šå…±äº« state å—ï¼Ÿ** ä¸ä¼šã€‚è‡ªå®šä¹‰ hook æ˜¯ä¸€ç§é‡ç”¨çŠ¶æ€é€»è¾‘çš„æœºåˆ¶ï¼ˆä¾‹å¦‚è®¾ç½®ä¸ºè®¢é˜…å¹¶å­˜å‚¨å½“å‰å€¼ï¼‰ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨è‡ªå®šä¹‰ hook æ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰ state å’Œå‰¯ä½œç”¨éƒ½æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚

**è‡ªå®šä¹‰ hook å¦‚ä½•è·å–ç‹¬ç«‹çš„ stateï¼Ÿ** æ¯æ¬¡è°ƒç”¨ hookï¼Œå®ƒéƒ½ä¼šè·å–ç‹¬ç«‹çš„ stateã€‚

è‡ªå®šä¹‰ hook è§£å†³äº†ä»¥å‰åœ¨ React ç»„ä»¶ä¸­æ— æ³•çµæ´»å…±äº«é€»è¾‘çš„é—®é¢˜ã€‚ä½ å¯ä»¥åˆ›å»ºæ¶µç›–å„ç§åœºæ™¯çš„è‡ªå®šä¹‰ hookï¼Œå¦‚è¡¨å•å¤„ç†ã€åŠ¨ç”»ã€è®¢é˜…å£°æ˜ã€è®¡æ—¶å™¨ï¼Œç”šè‡³å¯èƒ½è¿˜æœ‰å…¶ä»–æˆ‘ä»¬æ²¡æœ‰æƒ³è±¡åˆ°çš„åœºæ™¯ã€‚

## Hook API ç´¢å¼• - åŸºç¡€ Hook

### useState

```tsx
const [state, setState] = useState(initialState);
```

è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸º stateï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºæ›´æ–°è¿™ä¸ª state çš„å‡½æ•°ã€‚

åœ¨åˆå§‹æ¸²æŸ“æœŸé—´ï¼Œè¿”å›çš„çŠ¶æ€ä¸ä¼ å…¥çš„åˆå§‹å€¼ï¼ˆinitialStateï¼‰å€¼ç›¸åŒã€‚

`setState`å‡½æ•°ç”¨äºæ›´æ–° stateï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæ–°çš„ state å€¼å¹¶å°†ç»„ä»¶çš„ä¸€æ¬¡é‡æ–°æ¸²æŸ“åŠ å…¥é˜Ÿåˆ—ã€‚

```tsx
setState(newState);
```

åœ¨åç»­çš„é‡æ–°æ¸²æŸ“ä¸­ï¼ŒuseState è¿”å›çš„ç¬¬ä¸€ä¸ªå€¼å°†å§‹ç»ˆæ˜¯æ›´æ–°åæœ€æ–°çš„ stateã€‚

>**æ³¨æ„ï¼š**
>
>React ä¼šç¡®ä¿ setState çš„å‡½æ•°æ ‡è¯†æ˜¯ç¨³å®šçš„ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶å‘ç”Ÿå˜åŒ–ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥å®‰å…¨åœ°ä» useEffect æˆ– useCallback çš„ä¾èµ–åˆ—è¡¨ä¸­çœç•¥ setStateã€‚

#### å‡½æ•°å¼æ›´æ–°

å¦‚æœæ–°çš„ state éœ€è¦é€šè¿‡å…ˆå‰çš„ state è®¡ç®—å¾—å‡ºï¼Œé‚£ä¹ˆå¯ä»¥å°†å‡½æ•°ä¼ ç»™ setStateã€‚è¯¥å‡½æ•°å°†æ¥æ”¶ä¹‹å‰çš„ stateï¼Œå¹¶è¿”å›ä¸€ä¸ªæ›´æ–°åçš„å€¼ã€‚ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº† setState çš„ä¸¤ç§ç”¨æ³•ï¼š

```tsx
function Counter({initialCount}) {
  const [count, setCount] = useState(initialCount);
  return (
    <>
      Count: {count}
      <button onClick={() => setCount(initialCount)}>Reset</button>
      <button onClick={() => setCount(prevCount => prevCount - 1)}>-</button>
      <button onClick={() => setCount(prevCount => prevCount + 1)}>+</button>
    </>
  );
}
```

åŠ å‡æŒ‰é’®é‡‡ç”¨å‡½æ•°å½¢å¼ï¼Œå› ä¸ºè¢«æ›´æ–°çš„ state éœ€è¦åŸºäºä¹‹å‰çš„ state è®¡ç®—è€Œæ¥ã€‚ä½†æ˜¯â€œé‡ç½®â€æŒ‰é’®åˆ™é‡‡ç”¨æ™®é€šå½¢å¼ï¼Œå› ä¸ºå®ƒæ€»æ˜¯æŠŠ count è®¾ç½®å›åˆå§‹å€¼ã€‚

å¦‚æœæ›´æ–°å‡½æ•°çš„è¿”å›å€¼ä¸å½“å‰ state å®Œå…¨ç›¸åŒï¼Œåˆ™éšåçš„é‡æ¸²æŸ“ä¼šè¢«è·³è¿‡ã€‚

> æ³¨æ„ï¼š
>
> ä¸ class ç»„ä»¶çš„ setState æ–¹æ³•ä¸åŒï¼ŒuseState ä¸ä¼šè‡ªåŠ¨åˆå¹¶æ›´æ–°å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°å¼çš„ setState ç»“åˆå±•å¼€è¿ç®—ç¬¦æ¥è¾¾åˆ°åˆå¹¶æ›´æ–°åçš„æ•ˆæœã€‚
>
> ```tsx
> setState(prevState => {
>   // ä¹Ÿå¯ä»¥ä½¿ç”¨ Object.assign
>   return {...prevState, ...updatedValues};
> });
> ```
>
> `useReducer`æ˜¯å¦ä¸€ç§å¯é€‰æ–¹æ¡ˆï¼Œå®ƒæ›´é€‚ç”¨äºç®¡ç†åŒ…å«å¤šä¸ªå­å€¼çš„ state å¯¹è±¡ã€‚

#### æƒ°æ€§åˆå§‹ state

`initialState`å‚æ•°åªä¼šåœ¨ç»„ä»¶çš„åˆå§‹æ¸²æŸ“ä¸­èµ·ä½œç”¨ï¼Œåç»­æ¸²æŸ“æ—¶ä¼šè¢«å¿½ç•¥ã€‚å¦‚æœåˆå§‹ state éœ€è¦é€šè¿‡å¤æ‚è®¡ç®—è·å¾—ï¼Œåˆ™å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°ä¸­è®¡ç®—å¹¶è¿”å›åˆå§‹çš„ stateï¼Œæ­¤å‡½æ•°åªåœ¨åˆå§‹æ¸²æŸ“æ—¶è¢«è°ƒç”¨ï¼š

```tsx
const [state, setState] = useState(()=>{
	const initialState = someExpensiveComputation(props)
	return initialState
})
```

#### è·³è¿‡ state æ›´æ–°

è°ƒç”¨ State Hook çš„æ›´æ–°å‡½æ•°å¹¶ä¼ å…¥å½“å‰çš„ state æ—¶ï¼ŒReact å°†è·³è¿‡å­ç»„ä»¶çš„æ¸²æŸ“åŠ effect çš„æ‰§è¡Œï¼ˆReact ä½¿ç”¨ `Object.is` æ¯”è¾ƒç®—æ³•æ¥æ¯”è¾ƒ stateï¼‰ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒReact ä»å¯èƒ½éœ€è¦åœ¨è·³è¿‡æ¸²æŸ“å‰æ¸²æŸ“è¯¥ç»„ä»¶ã€‚ä¸è¿‡ç”±äº React ä¸ä¼šå¯¹ç»„ä»¶æ ‘çš„æ·±å±‚èŠ‚ç‚¹è¿›è¡Œä¸å¿…è¦çš„æ¸²æŸ“ï¼Œæ‰€ä»¥å¤§å¯ä¸å¿…æ‹…å¿ƒã€‚å¦‚æœåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œäº†é«˜å¼€é”€çš„è®¡ç®—ï¼Œå¯ä»¥ä½¿ç”¨ useMemo è¿›è¡Œä¼˜åŒ–ã€‚

### useEffect

```tsx
useEffect(didUpdate);
```

è¯¥ hook æ¥æ”¶ä¸€ä¸ªåŒ…å«å‘½ä»¤å¼ï¼Œä¸”å¯èƒ½åŒ…å«å‰¯ä½œç”¨ä»£ç çš„å‡½æ•°ã€‚

**åœ¨å‡½æ•°ç»„ä»¶ä¸»ä½“å†…ï¼ˆåœ¨Reactæ¸²æŸ“é˜¶æ®µï¼‰æ”¹å˜DOMã€æ·»åŠ è®¢é˜…ã€è®¾ç½®å®šæ—¶å™¨ã€è®°å½•æ—¥å¿—ä»¥åŠæ‰§è¡Œå…¶ä»–åŒ…å«å‰¯ä½œç”¨çš„æ“ä½œéƒ½æ˜¯ä¸è¢«å…è®¸çš„ï¼Œ** å› ä¸ºè¿™å¯èƒ½äº§ç”Ÿè«åå…¶å¦™çš„ bug å¹¶ç ´å UI çš„ä¸€è‡´æ€§ã€‚

ä½¿ç”¨ useEffect å®Œæˆå‰¯ä½œç”¨æ“ä½œã€‚èµ‹å€¼ç»™ useEffect çš„å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¸²æŸ“åˆ°å±å¹•ä¹‹åå¼€å§‹æ‰§è¡Œã€‚*å¯ä»¥æŠŠ effect çœ‹ä½œä» React çš„çº¯å‡½æ•°å¼ä¸–ç•Œé€šå¾€å‘½ä»¤å¼ä¸–ç•Œçš„é€ƒç”Ÿé€šé“ã€‚*

**é»˜è®¤æƒ…å†µä¸‹ï¼Œeffct å°†åœ¨æ¯è½®æ¸²æŸ“ç»“æŸåæ‰§è¡Œï¼Œä½†æˆ‘ä»¬å¯ä»¥é€‰æ‹©è®©ä»–åœ¨åªæœ‰æŸäº›å€¼æ”¹å˜çš„æ—¶å€™æ‰§è¡Œã€‚**

#### æ¸…é™¤ effect

é€šå¸¸ï¼Œç»„ä»¶å¸è½½æ—¶éœ€è¦æ¸…é™¤ effect åˆ›å»ºçš„è¯¸å¦‚è®¢é˜…æˆ–è®¡æ—¶å™¨ID ç­‰èµ„æºã€‚è¦å®ç°æ­¤åŠŸèƒ½ï¼ŒuseEffect éœ€è¦è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ã€‚ä»¥ä¸‹å°±æ˜¯ä¸€ä¸ªåˆ›å»ºè®¢é˜…çš„ä¾‹å­ï¼š

```tsx
useEffect(()=>{
	const subscription = props.source.subscribe()
	return ()=>{
		subscription.unsubscribe()
	}
})
```

ä¸ºé˜²æ­¢å†…å­˜æ³„æ¼ï¼Œæ¸…é™¤å‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½å‰æ‰§è¡Œã€‚å¦å¤–ï¼Œå¦‚æœç»„ä»¶å¤šæ¬¡æ¸²æŸ“ï¼Œåˆ™åœ¨æ‰§è¡Œä¸‹ä¸€ä¸ª effect ä¹‹å‰ï¼Œä¸Šä¸€ä¸ª effect å°±å·²ç»è¢«æ¸…é™¤ã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæ„å‘³ç€ç»„ä»¶çš„æ¯ä¸€æ¬¡æ›´æ–°éƒ½ä¼šåˆ›å»ºæ–°çš„è®¢é˜…ã€‚æƒ³è¦é¿å…æ¯æ¬¡æ›´æ–°éƒ½è§¦å‘ effect çš„æ›´æ–°ï¼Œè¯·å‚é˜…å¦‚ä¸‹ã€‚

#### effect çš„æ‰§è¡Œæ—¶æœº

ä¸ componentDidMountã€componentDidUpdate ä¸åŒçš„æ˜¯ï¼Œåœ¨æµè§ˆå™¨å®Œæˆå¸ƒå±€ä¸ç»˜åˆ¶ä¹‹åï¼Œä¼ ç»™ useEffect çš„å‡½æ•°ä¼šè¢«å»¶è¿Ÿè°ƒç”¨ ã€‚è¿™ä½¿å¾—å®ƒé€‚ç”¨äºè®¸å¤šå¸¸è§çš„å‰¯ä½œç”¨åœºæ™¯ï¼Œæ¯”å¦‚è®¾ç½®è®¢é˜…å’Œäº‹ä»¶å¤„ç†ç­‰æƒ…å†µï¼Œå› æ­¤ **ä¸åº”è¯¥åœ¨å‡½æ•°ä¸­æ‰§è¡Œé˜»å¡æµè§ˆå™¨æ›´æ–°å±å¹•çš„æ“ä½œ** ã€‚

ç„¶è€Œå¹¶éæ‰€æœ‰ effect éƒ½å¯ä»¥è¢«å»¶è¿Ÿæ‰§è¡Œï¼Œæ¯”å¦‚åœ¨æµè§ˆå™¨æ‰§è¡Œä¸‹ä¸€æ¬¡ç»˜åˆ¶å‰ï¼Œç”¨æˆ·å¯è§çš„ DOM å˜æ›´å°±å¿…é¡»è¢«åŒæ­¥æ‰§è¡Œï¼Œè¿™æ ·ç”¨æˆ·æ‰ä¸ä¼šæ„Ÿè§‰åˆ°è§†è§‰ä¸Šçš„ä¸ä¸€è‡´ï¼ˆæ¦‚å¿µä¸Šç±»ä¼¼äºè¢«åŠ¨ç›‘å¬äº‹ä»¶å’Œä¸»åŠ¨ç›‘å¬äº‹ä»¶çš„åŒºåˆ«ï¼‰ã€‚React ä¸ºæ­¤æä¾›äº†ä¸€ä¸ªé¢å¤–çš„ useLayoutEffect Hook æ¥å¤„ç†è¿™ä¸€ç±» effectã€‚ä»–å’Œ useEffect çš„ API ç›¸åŒï¼Œåªæ˜¯è°ƒç”¨æ—¶æœºä¸åŒã€‚

è™½ç„¶ useEffect ä¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶åå»¶è¿Ÿæ‰§è¡Œï¼Œä½†ä¼šä¿è¯åœ¨ä»»ä½•æ–°çš„æ¸²æŸ“å‰æ‰§è¡Œã€‚React å°†åœ¨ç»„ä»¶æ›´æ–°å‰åˆ·æ–°ä¸Šä¸€è½®çš„ effectã€‚

#### effect çš„æ¡ä»¶æ‰§è¡Œ

é»˜è®¤æƒ…å†µä¸‹ï¼Œeffect ä¼šåœ¨æ¯è½®ç»„ä»¶æ¸²æŸ“åæ‰§è¡Œã€‚è¿™æ ·çš„è¯ï¼Œä¸€æ—¦ effect çš„ä¾èµ–å‘ç”Ÿå˜åŒ–ï¼Œå®ƒå°±ä¼šè¢«é‡æ–°åˆ›å»ºã€‚

ç„¶è€Œï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹è¿™ä¹ˆåšå¯èƒ½ä¼šçŸ«æ‰è¿‡æ­£ï¼Œæ¯”å¦‚åœ¨è®¢é˜…çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯ä¸€æ¬¡ç»„ä»¶æ›´æ–°æ—¶éƒ½é‡æ–°åˆ›å»ºè®¢é˜…ï¼Œè€Œåªéœ€è¦åœ¨ source prop å±æ€§æ”¹å˜æ—¶é‡æ–°åˆ›å»ºã€‚

è¦å®ç°æ­¤åŠŸèƒ½ï¼Œéœ€è¦ç»™ useEffect ä¼ é€’ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒè¡¨ç¤º **effect æ‰€ä¾èµ–çš„å€¼æ•°ç»„**  ï¼š

```tsx
useEffect(
  () => {
    const subscription = props.source.subscribe();
    return () => {
      subscription.unsubscribe();
    };
  },
  [props.source],
);
```

è¿™æ ·ä¸€æ¥ï¼Œåªæœ‰å½“ props.source æ”¹å˜åæ‰ä¼šé‡æ–°åˆ›å»ºè®¢é˜…ã€‚

> æ³¨æ„ï¼š
>
> å¦‚æœè¦ä½¿ç”¨æ­¤ä¼˜åŒ–æ–¹å¼ï¼Œéœ€è¦ç¡®ä¿æ•°ç»„ä¸­åŒ…å«äº† **æ‰€æœ‰å¤–éƒ¨ä½œç”¨åŸŸä¼šå‘ç”Ÿå˜åŒ–ä¸”åœ¨ effect ä¸­ä½¿ç”¨çš„å˜é‡**ï¼Œå¦åˆ™ä»£ç å°†ä¼šå¼•ç”¨åˆ°å…ˆå‰æ¸²æŸ“ä¸­çš„æ—§å˜é‡ã€‚
>
> å¦‚æœæƒ³æ‰§è¡Œåªè¿è¡Œä¸€æ¬¡çš„ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ`[]`ï¼‰ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™å°±å‘Šè¯‰ React ä½ çš„ effect ä¸ä¾èµ–äº props æˆ– state ä¸­çš„ä»»ä½•å€¼ï¼Œæ‰€ä»¥å®ƒæ°¸è¿œéƒ½ä¸éœ€è¦é‡å¤æ‰§è¡Œã€‚è¿™å¹¶ä¸å±äºç‰¹æ®Šæƒ…å†µ â€”â€” å®ƒä¾ç„¶éµå¾ªè¾“å…¥æ•°ç»„çš„å·¥ä½œæ–¹å¼ã€‚

ä¾èµ–é¡¹æ•°ç»„ä¸ä¼šä½œä¸ºå‚æ•°ä¼ ç»™ effect å‡½æ•°ã€‚è™½ç„¶ä»æ¦‚å¿µä¸Šæ¥è¯´å®ƒè¡¨ç°ä¸ºï¼šæ‰€æœ‰ effect å‡½æ•°ä¸­å¼•ç”¨çš„å€¼éƒ½åº”è¯¥å‡ºç°åœ¨ä¾èµ–é¡¹æ•°ç»„ä¸­ã€‚æœªæ¥ç¼–è¯‘å™¨ä¼šæ›´åŠ æ™ºèƒ½ï¼Œå±Šæ—¶è‡ªåŠ¨åˆ›å»ºæ•°ç»„å°†æˆä¸ºå¯èƒ½ã€‚

### useContext

```tsx
const value = useContext(MyContext);
```

å®ƒæ¥æ”¶ä¸€ä¸ª Context å¯¹è±¡ (React.createContextçš„è¿”å›å€¼) å¹¶è¿”å›è¯¥ context çš„å½“å‰å€¼ã€‚å½“å‰çš„ context å€¼ç”±ä¸Šå±‚ç»„ä»¶ä¸­è·ç¦»å½“å‰ç»„ä»¶æœ€è¿‘çš„ `<MyContext.Provider>` çš„ `value` prop å†³å®šã€‚

å½“ç»„ä»¶ä¸Šå±‚æœ€è¿‘çš„ `MyContext.Provider` æ›´æ–°æ—¶ï¼Œè¯¥ hook ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œå¹¶ä½¿ç”¨æœ€æ–°ä¼ é€’ç»™ `MyContext` Provider çš„ context valueå€¼ã€‚å³ä½¿ç¥–å…ˆä½¿ç”¨ React.memo æˆ– shouldComponentUpdateï¼Œä¹Ÿä¼šåœ¨ç»„ä»¶æœ¬èº«ä½¿ç”¨ useContext æ—¶é‡æ–°æ¸²æŸ“ã€‚

è°ƒç”¨äº† useContext çš„ç»„ä»¶æ€»ä¼šåœ¨ context å€¼å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ã€‚å¦‚æœé‡æ¸²æŸ“ç»„ä»¶çš„å¼€é”€è¾ƒå¤§ï¼Œå¯ä»¥ä½¿ç”¨ [memorization](https://github.com/facebook/react/issues/15156#issuecomment-474590693) æ¥ä¼˜åŒ–ã€‚

ç¤ºä¾‹ï¼š

```tsx
const themes = {
  light: {
    foreground: "#000000",
    background: "#eeeeee"
  },
  dark: {
    foreground: "#ffffff",
    background: "#222222"
  }
};

const ThemeContext = React.createContext(themes.light);

function App() {
  return (
    <ThemeContext.Provider value={themes.dark}>
      <Toolbar />
    </ThemeContext.Provider>
  );
}

function Toolbar(props) {
  return (
    <div>
      <ThemedButton />
    </div>
  );
}

function ThemedButton() {
  const theme = useContext(ThemeContext);
  return (
    <button style={{ background: theme.background, color: theme.foreground }}>
      I am styled by theme context!
    </button>
  );
}
```

## Hook API ç´¢å¼• - é¢å¤– Hook

ä»¥ä¸‹ä»‹ç»çš„ hookï¼Œæœ‰äº›æ˜¯åŸºç¡€ hook çš„å˜ä½“ï¼Œæœ‰äº›åˆ™ä»…åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ä¼šç”¨åˆ°ã€‚

### useReducer

```tsx
const [state, dispatch] = useReducer(reducer, initialArg, init);
```

useState çš„æ›¿ä»£æ–¹æ¡ˆã€‚

å®ƒæ¥æ”¶ä¸€ä¸ªå½¢å¦‚ `(state, dispatch) => newState` çš„ reducerï¼Œ å¹¶è¿”å›å½“å‰çš„ state ä»¥åŠä¸å…¶é…å¥—çš„ `dispatch` æ–¹æ³•ï¼ˆç±»ä¼¼äº reduxï¼‰ã€‚

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒuseReducer ä¼šæ¯” useState æ›´åŠ é€‚ç”¨ï¼Œä¾‹å¦‚ state é€»è¾‘è¾ƒå¤æ‚ä¸”åŒ…å«å¤šä¸ªå­å€¼ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ª state ä¾èµ–å‰ä¸€ä¸ª state ç­‰ã€‚å¹¶ä¸”ï¼Œä½¿ç”¨ useReducer è¿˜èƒ½ç»™é‚£äº›è§¦å‘æ·±æ›´æ–°çš„ç»„ä»¶åšæ€§èƒ½ä¼˜åŒ–ï¼Œå› ä¸ºä½ å¯ä»¥å‘å­ç»„ä»¶ä¼ é€’ dispatch è€Œä¸æ˜¯å›è°ƒå‡½æ•°ï¼ˆåŸºäºcontextï¼‰ã€‚

ä½¿ç”¨ useReducer é‡å†™è®¡æ•°å™¨ï¼š

```tsx
const initialState = {count: 0};

function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return {count: state.count + 1};
    case 'decrement':
      return {count: state.count - 1};
    default:
      throw new Error();
  }
}

function Counter() {
  const [state, dispatch] = useReducer(reducer, initialState);
  return (
    <>
      Count: {state.count}
      <button onClick={() => dispatch({type: 'decrement'})}>-</button>
      <button onClick={() => dispatch({type: 'increment'})}>+</button>
    </>
  );
}
```

> æ³¨æ„ï¼š
>
> React ä¼šç¡®ä¿ dispatch å‡½æ•°çš„æ ‡è¯†æ˜¯ç¨³å®šçš„ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥å®‰å…¨åœ°ä» useEffect æˆ– useCallback çš„ä¾èµ–åˆ—è¡¨ä¸­çœç•¥ dispatchã€‚

#### æŒ‡å®šåˆå§‹ state

æœ‰ä¸¤ç§ä¸åŒçš„åˆå§‹åŒ– useReducer state çš„æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®åœºæ™¯é€‰æ‹©å…¶ä¸­çš„ä¸€ç§ã€‚

##### 1. å°†åˆå§‹ state ä½œä¸º useReducer çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥

```tsx
const [ state, dispatch ] = useReducer(reducer, {count: initialCount})
```

> æ³¨æ„
>
> React ä¸ä½¿ç”¨ `state = initialState` è¿™ä¸€ç”± Redux æ¨å¹¿å¼€æ¥çš„å‚æ•°çº¦å®šã€‚æœ‰æ—¶å€™åˆå§‹å€¼ä¾èµ–äº propsï¼Œå› æ­¤éœ€è¦åœ¨è°ƒç”¨ Hook æ—¶æŒ‡å®šã€‚å¦‚æœä½ ç‰¹åˆ«å–œæ¬¢ä¸Šè¿°çš„å‚æ•°çº¦å®šï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ `useReducer(reducer, undefined, reducer)` æ¥æ¨¡æ‹Ÿ Redux çš„è¡Œä¸ºï¼Œä½†æˆ‘ä»¬ä¸é¼“åŠ±ä½ è¿™ä¹ˆåšã€‚

##### 2. æƒ°æ€§åˆå§‹åŒ–

æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©æƒ°æ€§åˆå§‹åŒ– stateã€‚ä¸ºæ­¤ï¼Œéœ€è¦å°† init å‡½æ•°ä½œä¸º useReducer çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ï¼Œè¿™æ ·åˆå§‹ state å°†ä¼šè¢«è®¾ç½®ä¸º `init(initialArg)`ã€‚

è¿™æ ·åšå¯ä»¥å°†ç”¨äºè®¡ç®— state çš„é€»è¾‘æå–åˆ° reducer å¤–éƒ¨ï¼Œè¿™ä¹Ÿä¸ºå°†æ¥é‡ç½® state çš„ action åšå¤„ç†æä¾›äº†ä¾¿åˆ©ã€‚

```tsx
function init(initialCount) {
  return {count: initialCount};
}

function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return {count: state.count + 1};
    case 'decrement':
      return {count: state.count - 1};
    case 'reset':
      return init(action.payload);
    default:
      throw new Error();
  }
}

function Counter({initialCount}) {
  const [state, dispatch] = useReducer(reducer, initialCount, init);
  return (
    <>
      Count: {state.count}
      <button
        onClick={() => dispatch({type: 'reset', payload: initialCount})}>
        Reset
      </button>
      <button onClick={() => dispatch({type: 'decrement'})}>-</button>
      <button onClick={() => dispatch({type: 'increment'})}>+</button>
    </>
  );
}

```

### useRef

```tsx
const refContainer = useRef(initialValue)
```

useRef è¿”å›ä¸€ä¸ªå¯å˜çš„ ref å¯¹è±¡ï¼Œå…¶ `.current` å±æ€§è¢«åˆå§‹åŒ–ä¸ºä¼ å…¥çš„å‚æ•°ï¼ˆinitialValueï¼‰ã€‚è¿”å›çš„ ref å¯¹è±¡åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜ã€‚

ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹ä¾¿æ˜¯å‘½ä»¤å¼åœ°è®¿é—®å­ç»„ä»¶ï¼š

```tsx
function TextInputWithButton() {
	const inputRef = useRef(null)
  const onButtonClick = () => {
    // currentæŒ‡å‘å·²ç»æŒ‚è½½åˆ° DOM ä¸Šçš„inputå…ƒç´ 
    inputRef.current.focus()
  }
  return (
  	<>
    	<input ref={inputRef} />
	    <button onClick={onButtonClick}>focus the input</button>
    </>
  )
}
```

ä»æœ¬è´¨ä¸Šè¯´ï¼Œ`useRef()` å°±åƒæ˜¯ä¸€ä¸ªå¯ä»¥åœ¨å…¶ .current å±æ€§ä¸­ä¿å­˜ä¸€ä¸ªå¯å˜å€¼çš„ç›’å­ã€‚

å°±ä¸Šé¢çš„ç”¨æ³•æ¥æ”¶ï¼Œ`useRef()` è·Ÿ ref å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚ä½†å®ƒæ¯” ref æ›´åŠ æœ‰ç”¨ï¼Œå®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¿å­˜ä»»ä½•å¯å˜å€¼ï¼Œç±»ä¼¼äºåœ¨ class ä¸­ä½¿ç”¨å®ä¾‹å­—æ®µçš„æ–¹å¼ã€‚

è¿™æ˜¯å› ä¸ºå®ƒåˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ™®é€šçš„ javascript å¯¹è±¡ã€‚**è€Œ `useRef()` å’Œè‡ªå»ºä¸€ä¸ª `{current: ...}` å¯¹è±¡çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼ŒuseRef ä¼šåœ¨æ¯ä¸€æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ª ref å¯¹è±¡** ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ ref å¯¹è±¡å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒuseRef å¹¶ä¸ä¼šé€šçŸ¥ä½ ã€‚å˜æ›´ `.current` å±æ€§ä¸ä¼šå¼•å‘é‡æ–°æ¸²æŸ“ã€‚å¦‚æœæƒ³åœ¨ React ç»‘å®šæˆ–è§£ç»‘ DOM èŠ‚ç‚¹çš„ ref æ—¶è¿è¡ŒæŸäº›ä»£ç ï¼Œè¯·å‚è€ƒ[å›è°ƒref](https://react.docschina.org/docs/hooks-faq.html#how-can-i-measure-a-dom-node)ã€‚

### useImperativeHandle

```tsx
useImperativeHandle(ref, createHandle, [deps])
```

`useImperative` å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ ref æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”å½“é¿å…ä½¿ç”¨ ref è¿™æ ·çš„å‘½ä»¤å¼ä»£ç ã€‚`useImperativeHandle` åº”å½“ä¸ `React.forwordRef` ä¸€èµ·ä½¿ç”¨ã€‚

```tsx
function FancyInput(props, ref) {
  const inputRef = useRef();
  useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus();
    }
  }));
  return <input ref={inputRef} ... />;
}
FancyInput = forwardRef(FancyInput);
```

è¿™æ ·ä¸€æ¥ï¼Œæ¸²æŸ“ `<FancyInput ref={inputRef} />` çš„çˆ¶ç»„ä»¶å¯ä»¥è°ƒç”¨ `inputRef.current.inputfocus()` æ¥ä½¿å­ç»„ä»¶ä¸­çš„ input è·å¾—ç„¦ç‚¹ã€‚

### useLayoutEffect

å…¶å‡½æ•°ç­¾åä¸ `useEffect` ç›¸åŒï¼Œä½†å®ƒä¼šåœ¨æ‰€æœ‰çš„ DOM å˜æ›´ä¹‹ååŒæ­¥è°ƒç”¨ effectã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å– DOM å¸ƒå±€å¹¶åŒæ­¥è§¦å‘é‡æ¸²æŸ“ã€‚åœ¨æµè§ˆå™¨æ‰§è¡Œç»˜åˆ¶ä¹‹å‰ï¼Œ`useLayoutEffect` å†…éƒ¨çš„æ›´æ–°è®¡åˆ’å°†è¢«åŒæ­¥åˆ·æ–°ã€‚

å°½å¯èƒ½ä½¿ç”¨æ ‡å‡†çš„ `useEffect` ä»¥é¿å…é˜»å¡è§†è§‰æ›´æ–°ã€‚

### useDebugValue

```tsx
useDebugValue(value)
```

å®˜æ–¹çš„è¯´æ˜æ˜¯æŒ‡èƒ½å¤Ÿåœ¨ React å¼€å‘è€…å·¥å…·ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰ hook çš„æ ‡ç­¾ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨æœªèƒ½ç”Ÿæ•ˆï¼Œæš‚æ—¶è¿˜æ‰¾ä¸åˆ°åŸå› ã€‚

### useCallback / useMemo

æš‚æ—¶è¿˜æ²¡å®Œå…¨ç†è§£è¿™ä¸¤ä¸ª hookã€‚













